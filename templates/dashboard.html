{% extends "base.html" %}
{% block title %}Dashboard{% endblock %}
{% block content %}
<section id="dashboard" class="tab-content active">
  <div class="page-header">
    <h1>Dashboard</h1>
    <p>Visão geral do sistema de atividades</p>
    <div class="dashboard-stats">
      <span class="dashboard-date">
        <i class="fas fa-calendar-alt"></i>
        Última atualização: <strong id="current-date"></strong>
      </span>
    </div>
  </div>

  <div class="dashboard-grid">
    <!-- Empresas -->
    <div class="metric-card" data-metric="empresas">
      <div class="metric-icon empresas">
        <i class="fas fa-building"></i>
      </div>
      <div class="metric-content">
        <h3>Total de Empresas</h3>
        <div class="metric-value" data-target="{{ contas.empresas or 0 }}">{{ contas.empresas or 0 }}</div>
        <div class="metric-change neutral">
          <i class="fas fa-chart-line"></i>
          <span>Sistema ativo</span>
        </div>
        <div class="metric-footer">
          <small>Incluindo filiais</small>
        </div>
      </div>
    </div>

    <!-- Total de Contas -->
    <div class="metric-card" data-metric="contas">
      <div class="metric-icon contas">
        <i class="fas fa-users"></i>
      </div>
      <div class="metric-content">
        <h3>Total de Contas</h3>
        <div class="metric-value" data-target="{{ (contas.pendente or 0) + (contas.fazendo or 0) + (contas.feito or 0) }}">{{ (contas.pendente or 0) + (contas.fazendo or 0) + (contas.feito or 0) }}</div>
        <div class="metric-change positive">
          <i class="fas fa-arrow-up"></i>
          <span>Todas as contas</span>
        </div>
        <div class="metric-footer">
          <small>Todos os status</small>
        </div>
      </div>
    </div>

    <!-- Pendentes -->
    <div class="metric-card" data-metric="pendentes">
      <div class="metric-icon pendentes">
        <i class="fas fa-clock"></i>
      </div>
      <div class="metric-content">
        <h3>Contas Pendentes</h3>
        <div class="metric-value" data-target="{{ contas.pendente or 0 }}">{{ contas.pendente or 0 }}</div>
        <div class="metric-change warning">
          <i class="fas fa-exclamation-triangle"></i>
          <span>Requer atenção</span>
        </div>
        <div class="metric-footer">
          <small>Aguardando processamento</small>
        </div>
      </div>
    </div>

    <!-- Fazendo -->
    <div class="metric-card" data-metric="fazendo">
      <div class="metric-icon fazendo">
        <i class="fas fa-tasks"></i>
      </div>
      <div class="metric-content">
        <h3>Contas em Andamento</h3>
        <div class="metric-value" data-target="{{ contas.fazendo or 0 }}">{{ contas.fazendo or 0 }}</div>
        <div class="metric-change neutral">
          <i class="fas fa-sync-alt fa-spin"></i>
          <span class="loading-text">Em processamento<span class="dots"></span></span>
        </div>
        <div class="metric-footer">
          <small>Sendo processadas</small>
        </div>
      </div>
    </div>

    <!-- Concluídas -->
    <div class="metric-card" data-metric="concluidas">
      <div class="metric-icon concluidas">
        <i class="fas fa-check-circle"></i>
      </div>
      <div class="metric-content">
        <h3>Contas Concluídas</h3>
        <div class="metric-value" data-target="{{ contas.feito or 0 }}">{{ contas.feito or 0 }}</div>
        <div class="metric-change success">
          <i class="fas fa-check"></i>
          <span>Finalizadas</span>
        </div>
        <div class="metric-footer">
          <small>Processamento completo</small>
        </div>
      </div>
    </div>

    <!-- Card de Progresso -->
    <div class="metric-card" data-metric="progresso">
      <div class="metric-icon faturamento">
        <i class="fas fa-chart-pie"></i>
      </div>
      <div class="metric-content">
        <h3>Taxa de Conclusão</h3>
        <div class="metric-value" data-target="{% if (contas.pendente or 0) + (contas.fazendo or 0) + (contas.feito or 0) > 0 %}{{ ((contas.feito or 0) * 100 / ((contas.pendente or 0) + (contas.fazendo or 0) + (contas.feito or 0)))|round|int }}{% else %}0{% endif %}">
          {% if (contas.pendente or 0) + (contas.fazendo or 0) + (contas.feito or 0) > 0 %}
            {{ ((contas.feito or 0) * 100 / ((contas.pendente or 0) + (contas.fazendo or 0) + (contas.feito or 0)))|round|int }}%
          {% else %}
            0%
          {% endif %}
        </div>
        <div class="metric-change {% if ((contas.feito or 0) * 100 / ((contas.pendente or 0) + (contas.fazendo or 0) + (contas.feito or 0) if (contas.pendente or 0) + (contas.fazendo or 0) + (contas.feito or 0) > 0 else 1))|round >= 75 %}success{% elif ((contas.feito or 0) * 100 / ((contas.pendente or 0) + (contas.fazendo or 0) + (contas.feito or 0) if (contas.pendente or 0) + (contas.fazendo or 0) + (contas.feito or 0) > 0 else 1))|round >= 50 %}positive{% else %}warning{% endif %}">
          <i class="fas fa-percentage"></i>
          <span>Do total</span>
        </div>
        <div class="metric-footer">
          <small>Eficiência do sistema</small>
        </div>
      </div>
    </div>
  </div>

  <!-- Atividades Recentes -->
  <div class="recent-activity">
    <div class="activity-header">
      <h3>
        <i class="fas fa-clock"></i>
        Atividades Recentes
      </h3>
      <button class="btn btn-outline" onclick="location.reload()">
        <i class="fas fa-sync-alt"></i>
        Atualizar
      </button>
    </div>
    
    <div class="activity-list">
      <div class="activity-item">
        <div class="activity-icon">
          <i class="fas fa-plus"></i>
        </div>
        <div class="activity-content">
          <p>Sistema iniciado com sucesso</p>
          <span class="activity-time">Hoje</span>
        </div>
      </div>
      
      {% if contas.pendente and contas.pendente > 0 %}
      <div class="activity-item">
        <div class="activity-icon">
          <i class="fas fa-exclamation-triangle"></i>
        </div>
        <div class="activity-content">
          <p>{{ contas.pendente }} conta(s) aguardando processamento</p>
          <span class="activity-time">Status atual</span>
        </div>
      </div>
      {% endif %}
      
      {% if contas.fazendo and contas.fazendo > 0 %}
      <div class="activity-item">
        <div class="activity-icon">
          <i class="fas fa-cog fa-spin"></i>
        </div>
        <div class="activity-content">
          <p>{{ contas.fazendo }} conta(s) sendo processada(s)</p>
          <span class="activity-time">Em andamento</span>
        </div>
      </div>
      {% endif %}
      
      {% if contas.feito and contas.feito > 0 %}
      <div class="activity-item">
        <div class="activity-icon">
          <i class="fas fa-check"></i>
        </div>
        <div class="activity-content">
          <p>{{ contas.feito }} conta(s) processada(s) com sucesso</p>
          <span class="activity-time">Concluído</span>
        </div>
      </div>
      {% endif %}
    </div>
  </div>
</section>
{% endblock %}